
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Feature Engineering - Splink</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#feature-engineering-for-data-linkage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Splink" class="md-header__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splink
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Feature Engineering
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Splink" class="md-nav__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../img/favicon.ico" alt="logo">

    </a>
    Splink
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Topic Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Topic Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Topic Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="backends.html" class="md-nav__link">
        Splink's SQL backends - Spark, DuckDB etc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="link_type.html" class="md-nav__link">
        Link type - linking vs deduping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="querying_splink_results.html" class="md-nav__link">
        Retrieving and querying Splink results
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Feature Engineering
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="feature_engineering.html" class="md-nav__link md-nav__link--active">
        Feature Engineering
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postcodes" class="md-nav__link">
    Postcodes
  </a>
  
    <nav class="md-nav" aria-label="Postcodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phonetic-transformations" class="md-nav__link">
    Phonetic transformations
  </a>
  
    <nav class="md-nav" aria-label="Phonetic transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" type="checkbox" id="__nav_2_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_5">
          Comparing Records
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparing Records" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_5">
          <span class="md-nav__icon md-icon"></span>
          Comparing Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="customising_comparisons.html" class="md-nav__link">
        Defining and customising comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison_templates.html" class="md-nav__link">
        Out-of-the-box comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparators.html" class="md-nav__link">
        String comparators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="phonetic.html" class="md-nav__link">
        Phonetic transformations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" type="checkbox" id="__nav_2_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_6">
          Performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Performance" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_6">
          <span class="md-nav__icon md-icon"></span>
          Performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="drivers_of_performance.html" class="md-nav__link">
        Run times, performance and linking large data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="blocking_rules.html" class="md-nav__link">
        Blocking rules for prediction vs estimation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="optimising_spark.html" class="md-nav__link">
        Optimising Spark performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="salting.html" class="md-nav__link">
        Salting blocking rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Linker API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Linker API" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Linker API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linker.html" class="md-nav__link">
        Full API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerexp.html" class="md-nav__link">
        Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerest.html" class="md-nav__link">
        Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerpred.html" class="md-nav__link">
        Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerqa.html" class="md-nav__link">
        Visualisation and quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../em_training_session.html" class="md-nav__link">
        EM Training Session API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SplinkDataFrame.html" class="md-nav__link">
        SplinkDataFrame API
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Comparisons API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparisons API" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Comparisons API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison.html" class="md-nav__link">
        Comparison
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level.html" class="md-nav__link">
        Comparison Level
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Comparisons Library API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparisons Library API" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Comparisons Library API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_library.html" class="md-nav__link">
        Comparison Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_template_library.html" class="md-nav__link">
        Comparison Template Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level_library.html" class="md-nav__link">
        Comparison Level Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level_composition.html" class="md-nav__link">
        Comparison Composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settingseditor/editor.html" class="md-nav__link">
        Settings Editor
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settings_dict_guide.html" class="md-nav__link">
        Settings dictionary reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/00_Tutorial_Introduction.html" class="md-nav__link">
        0. Tutorial introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/01_Prerequisites.html" class="md-nav__link">
        1. Data prep prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/02_Exploratory_analysis.html" class="md-nav__link">
        2. Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/03_Blocking.html" class="md-nav__link">
        3. Blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/04_Estimating_model_parameters.html" class="md-nav__link">
        4. Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/05_Predicting_results.html" class="md-nav__link">
        5. Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/06_Visualising_predictions.html" class="md-nav__link">
        6. Visualising predictions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/07_Quality_assurance.html" class="md-nav__link">
        7. Quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_index.html" class="md-nav__link">
        Examples index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          DuckDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DuckDB" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          DuckDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_deduplicate_50k_synthetic.html" class="md-nav__link">
        Deduplicate 50k rows historical persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_transactions.html" class="md-nav__link">
        Linking financial transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_link_only.html" class="md-nav__link">
        Linking two tables of persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_real_time_record_linkage.html" class="md-nav__link">
        Real time record linkage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_accuracy_analysis_from_labels_column.html" class="md-nav__link">
        QA from ground truth column
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_pairwise_labels.html" class="md-nav__link">
        Estimating m probabilities from labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_quick_and_dirty_persons.html" class="md-nav__link">
        Quick and dirty persons model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_febrl3.html" class="md-nav__link">
        Febrl3 Dedupe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_febrl4.html" class="md-nav__link">
        Febrl4 link-only
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_3" type="checkbox" id="__nav_7_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_3">
          PySpark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PySpark" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          PySpark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../demos/example_simple_pyspark.html" class="md-nav__link">
        Deduplication using Pyspark
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Developers' guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developers' guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Developers' guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_1" type="checkbox" id="__nav_8_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_1">
          Making Changes to Splink
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Making Changes to Splink" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_1">
          <span class="md-nav__icon md-icon"></span>
          Making Changes to Splink
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/building_env_locally.html" class="md-nav__link">
        Building a Virtual Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/lint.html" class="md-nav__link">
        Linting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/build_docs_locally.html" class="md-nav__link">
        Building Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/running_tests_locally.html" class="md-nav__link">
        Running Tests
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/releases.html" class="md-nav__link">
        Releasing a Package Version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/caching.html" class="md-nav__link">
        Caching and pipelining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/debug_modes.html" class="md-nav__link">
        Understanding and debugging Splink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/spark_pipelining_and_caching.html" class="md-nav__link">
        Spark caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/transpilation.html" class="md-nav__link">
        Transpilation using sqlglot
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_6" type="checkbox" id="__nav_8_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_6">
          Comparisons and comparison levels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Comparisons and comparison levels" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_6">
          <span class="md-nav__icon md-icon"></span>
          Comparisons and comparison levels
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/comparisons/new_library_comparisons_and_levels.html" class="md-nav__link">
        Creating new comparisons and comparison levels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/comparisons/extending_library_comparisons_and_levels.html" class="md-nav__link">
        Extending existing comparisons and comparison levels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/udfs.html" class="md-nav__link">
        User-Defined Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#postcodes" class="md-nav__link">
    Postcodes
  </a>
  
    <nav class="md-nav" aria-label="Postcodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#phonetic-transformations" class="md-nav__link">
    Phonetic transformations
  </a>
  
    <nav class="md-nav" aria-label="Phonetic transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    Example
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  

  <nav class="md-tags" >
    
      
      
        <span class="md-tag">API</span>
      
    
      
      
        <span class="md-tag">Feature Engineering</span>
      
    
      
      
        <span class="md-tag">Comparisons</span>
      
    
      
      
        <span class="md-tag">Postcode</span>
      
    
      
      
        <span class="md-tag">Phonetic Transformations</span>
      
    
      
      
        <span class="md-tag">Soundex</span>
      
    
      
      
        <span class="md-tag">Metaphone</span>
      
    
      
      
        <span class="md-tag">Double Metaphone</span>
      
    
  </nav>



  <a href="https://github.com/moj-analytical-services/splink/edit/master/docs/topic_guides/feature_engineering.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="feature-engineering-for-data-linkage">Feature Engineering for Data Linkage<a class="headerlink" href="#feature-engineering-for-data-linkage" title="Permanent link">&para;</a></h1>
<p>During record linkage, the features in a given dataset are used to provide evidence as to whether two records are a match. Like any predictive model, the quality of a Splink model is dictated by the features provided. </p>
<p>Below are some examples of features that be created from common columns, and how to create more detailed comparisons with them in a Splink model.</p>
<h2 id="postcodes">Postcodes<a class="headerlink" href="#postcodes" title="Permanent link">&para;</a></h2>
<p>Many datasets contain postcode data and there are a number of ways to compare the postcode strings.</p>
<p>For example, levenshtein distances are useful to spot any typos/character swaps:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">splink.duckdb.duckdb_comparison_library</span> <span class="k">as</span> <span class="nn">cl</span>

<span class="n">postcode_comparison</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">levenshtein_at_thresholds</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">postcode_comparison</span><span class="o">.</span><span class="n">human_readable_description</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Comparison 'Exact match vs. levenshtein at threshold 2 vs. anything else' of "postcode".</p>
<p>Similarity is assessed using the following ComparisonLevels:</p>
<ul>
<li>'Null' with SQL rule: "postcode_l" IS NULL OR "postcode_r" IS NULL</li>
<li>'Exact match' with SQL rule: "postcode_l" = "postcode_r"</li>
<li>Levenshtein &lt;= 2' with SQL rule: levenshtein("postcode_l", "postcode_r") &lt;= 2</li>
<li>'All other comparisons' with SQL rule: ELSE</li>
</ul>
</blockquote>
<p>However, string comparators alone don't necessarily give the best sense of whether two postcodes are similar. Another way of considering similarity of postcodes is the physical distance between them. Splink has a functions to calculate the distance between two sets of coordinates (<a href="../comparison_level_library.html#splink.comparison_level_library.DistanceFunctionLevelBase">cll.distance_in_KM_level()</a> and <a href="../comparison_library.html#splink.comparison_library.DistanceInKMAtThresholdsComparisonBase">cl.distance_in_KM_at_thresholds()</a>) which can be utilised, alongside string comparisons, to give better results.</p>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<p>There are a number of open source repositories of geospatial data that can be used for linkage, one example is <a href="http://download.geonames.org/export/zip/">geonames</a>. </p>
<p>Below is an example of adding latitude and longitude columns from geonames to create a more nuanced comparison.</p>
<p>Read in a dataset with postcodes:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;/PATH/TO/DEMO/DATA/historical_figures_with_errors_50k.parquet&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;postcode_fake&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;postcode_fake&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">unique_id</th>
<th align="left">cluster</th>
<th align="left">full_name</th>
<th align="left">first_and_surname</th>
<th align="left">first_name</th>
<th align="left">surname</th>
<th align="left">dob</th>
<th align="left">birth_place</th>
<th align="left">postcode_fake</th>
<th align="left">gender</th>
<th align="left">occupation</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">Q2296770-1</td>
<td align="left">Q2296770</td>
<td align="left">thomas clifford, 1st baron clifford of chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left">male</td>
<td align="left">politician</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">Q2296770-2</td>
<td align="left">Q2296770</td>
<td align="left">thomas of chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left">male</td>
<td align="left">politician</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">Q2296770-3</td>
<td align="left">Q2296770</td>
<td align="left">tom 1st baron clifford of chudleigh</td>
<td align="left">tom chudleigh</td>
<td align="left">tom</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left">male</td>
<td align="left">politician</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">Q2296770-4</td>
<td align="left">Q2296770</td>
<td align="left">thomas 1st chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8HU</td>
<td align="left"></td>
<td align="left">politician</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">Q2296770-5</td>
<td align="left">Q2296770</td>
<td align="left">thomas clifford, 1st baron chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left"></td>
<td align="left">politician</td>
</tr>
</tbody>
</table>
<p>Then read in a list of GB postcodes downloaded from <a href="http://download.geonames.org/export/zip/">geonames</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;country_code&#39;</span><span class="p">,</span> <span class="s1">&#39;postal_code&#39;</span><span class="p">,</span> <span class="s1">&#39;place_name&#39;</span><span class="p">,</span> <span class="s1">&#39;admin_name1&#39;</span><span class="p">,</span> <span class="s1">&#39;admin_code1&#39;</span><span class="p">,</span> <span class="s1">&#39;admin_name2&#39;</span><span class="p">,</span> <span class="s1">&#39;admin_code2&#39;</span><span class="p">,</span> <span class="s1">&#39;admin_name3&#39;</span><span class="p">,</span> <span class="s1">&#39;admin_code3&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span>
<span class="n">postcodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;GB_full.txt&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
<span class="n">postcodes</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">country_code</th>
<th align="left">postal_code</th>
<th align="left">place_name</th>
<th align="left">admin_name1</th>
<th align="left">admin_code1</th>
<th align="left">admin_name2</th>
<th align="right">admin_code2</th>
<th align="left">admin_name3</th>
<th align="left">admin_code3</th>
<th align="right">latitude</th>
<th align="right">longitude</th>
<th align="right">accuracy</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">GB</td>
<td align="left">AL3 8QE</td>
<td align="left">Slip End</td>
<td align="left">England</td>
<td align="left">ENG</td>
<td align="left">Bedfordshire</td>
<td align="right">nan</td>
<td align="left">Central Bedfordshire</td>
<td align="left">E06000056</td>
<td align="right">51.8479</td>
<td align="right">-0.4474</td>
<td align="right">6</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">GB</td>
<td align="left">AL5 3NG</td>
<td align="left">Harpenden</td>
<td align="left">England</td>
<td align="left">ENG</td>
<td align="left">Bedfordshire</td>
<td align="right">nan</td>
<td align="left">Central Bedfordshire</td>
<td align="left">E06000056</td>
<td align="right">51.8321</td>
<td align="right">-0.383</td>
<td align="right">6</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">GB</td>
<td align="left">AL5 3NS</td>
<td align="left">Hyde</td>
<td align="left">England</td>
<td align="left">ENG</td>
<td align="left">Bedfordshire</td>
<td align="right">nan</td>
<td align="left">Central Bedfordshire</td>
<td align="left">E06000056</td>
<td align="right">51.8333</td>
<td align="right">-0.3763</td>
<td align="right">6</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">GB</td>
<td align="left">AL5 3QF</td>
<td align="left">Hyde</td>
<td align="left">England</td>
<td align="left">ENG</td>
<td align="left">Bedfordshire</td>
<td align="right">nan</td>
<td align="left">Central Bedfordshire</td>
<td align="left">E06000056</td>
<td align="right">51.8342</td>
<td align="right">-0.3851</td>
<td align="right">6</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">GB</td>
<td align="left">B10 0AB</td>
<td align="left">Birmingham</td>
<td align="left">England</td>
<td align="left">ENG</td>
<td align="left">West Midlands</td>
<td align="right">nan</td>
<td align="left">Birmingham District (B)</td>
<td align="left">E08000025</td>
<td align="right">52.4706</td>
<td align="right">-1.875</td>
<td align="right">6</td>
</tr>
</tbody>
</table>
<p>Now combine the lat-long coordinates from the <code>GB_full.txt</code> lookup.</p>
<div class="highlight"><pre><span></span><code><span class="n">df_with_coordinates</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">postcodes</span><span class="p">[[</span><span class="s2">&quot;postal_code&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]],</span> 
                                    <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;postcode_fake&quot;</span><span class="p">,</span> 
                                    <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;postal_code&quot;</span><span class="p">,</span>
                                    <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="n">df_with_coordinates</span> <span class="o">=</span> <span class="n">df_with_coordinates</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;postcode_fake&#39;</span><span class="p">:</span><span class="s1">&#39;postcode&#39;</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_with_coordinates</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="left">unique_id</th>
<th align="left">cluster</th>
<th align="left">full_name</th>
<th align="left">first_and_surname</th>
<th align="left">first_name</th>
<th align="left">surname</th>
<th align="left">dob</th>
<th align="left">birth_place</th>
<th align="left">postcode</th>
<th align="left">gender</th>
<th align="left">occupation</th>
<th align="left">postal_code</th>
<th align="right">latitude</th>
<th align="right">longitude</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="left">Q2296770-1</td>
<td align="left">Q2296770</td>
<td align="left">thomas clifford, 1st baron clifford of chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left">male</td>
<td align="left">politician</td>
<td align="left">TQ13 8DF</td>
<td align="right">50.6927</td>
<td align="right">-3.8139</td>
</tr>
<tr>
<td align="right">1</td>
<td align="left">Q2296770-2</td>
<td align="left">Q2296770</td>
<td align="left">thomas of chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left">male</td>
<td align="left">politician</td>
<td align="left">TQ13 8DF</td>
<td align="right">50.6927</td>
<td align="right">-3.8139</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">Q2296770-3</td>
<td align="left">Q2296770</td>
<td align="left">tom 1st baron clifford of chudleigh</td>
<td align="left">tom chudleigh</td>
<td align="left">tom</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left">male</td>
<td align="left">politician</td>
<td align="left">TQ13 8DF</td>
<td align="right">50.6927</td>
<td align="right">-3.8139</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">Q2296770-4</td>
<td align="left">Q2296770</td>
<td align="left">thomas 1st chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8HU</td>
<td align="left"></td>
<td align="left">politician</td>
<td align="left">TQ13 8HU</td>
<td align="right">50.6876</td>
<td align="right">-3.8958</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">Q2296770-5</td>
<td align="left">Q2296770</td>
<td align="left">thomas clifford, 1st baron chudleigh</td>
<td align="left">thomas chudleigh</td>
<td align="left">thomas</td>
<td align="left">chudleigh</td>
<td align="left">1630-08-01</td>
<td align="left">devon</td>
<td align="left">TQ13 8DF</td>
<td align="left"></td>
<td align="left">politician</td>
<td align="left">TQ13 8DF</td>
<td align="right">50.6927</td>
<td align="right">-3.8139</td>
</tr>
</tbody>
</table>
<p>Now that coordinates have been added, a more detailed postcode comparison can be created to be included in a splink settings dictionary:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">splink.duckdb.duckdb_comparison_level_library</span> <span class="k">as</span> <span class="nn">cll</span>

<span class="n">postcode_comparison</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;output_column_name&#39;</span><span class="p">:</span> <span class="s1">&#39;postcode&#39;</span><span class="p">,</span>
    <span class="s1">&#39;comparison_description&#39;</span><span class="p">:</span> <span class="s1">&#39;Postcode&#39;</span><span class="p">,</span>
    <span class="s1">&#39;comparison_levels&#39;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">null_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">distance_in_km_level</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">distance_in_km_level</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">distance_in_km_level</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
        <span class="n">cll</span><span class="o">.</span><span class="n">else_level</span><span class="p">()</span>
    <span class="p">],</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="phonetic-transformations">Phonetic transformations<a class="headerlink" href="#phonetic-transformations" title="Permanent link">&para;</a></h2>
<p>Phonetic transformation algorithms can be used to identify words that sound similar, even if they are spelled differently. These are particularly useful for names and can be used as an additional comparison level within name comparisons.</p>
<p>For a more detailed explanation on phonetic transformation algorithms, see the <a href="phonetic.html">topic guide</a>.</p>
<h3 id="example_1">Example<a class="headerlink" href="#example_1" title="Permanent link">&para;</a></h3>
<p>There are a number of python packages which support phonetic transformations that can be applied to a pandas dataframe, which can then be loaded into the DuckDBLinker. For example, creating a <a href="phonetic.html#double-metaphone">Double Metaphone</a> column with the <a href="https://pypi.org/project/phonetics/">phonetics</a> python library:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">phonetics</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="s2">&quot;PATH/TO/DATA/fake_1000.parquet&quot;</span><span class="p">)</span>

<span class="c1"># Define a function to apply the dmetaphone phonetic algorithm to each name in the column</span>
<span class="k">def</span> <span class="nf">dmetaphone_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">phonetics</span><span class="o">.</span><span class="n">dmetaphone</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="c1"># Apply the function to the &quot;first_name&quot; and surname columns using the apply method</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;first_name_dm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dmetaphone_name</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;surname_dm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;surname&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">dmetaphone_name</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th align="right"></th>
<th align="right">unique_id</th>
<th align="left">first_name</th>
<th align="left">surname</th>
<th align="left">dob</th>
<th align="left">city</th>
<th align="left">email</th>
<th align="right">group</th>
<th align="left">first_name_dm</th>
<th align="left">surname_dm</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">Julia</td>
<td align="left"></td>
<td align="left">2015-10-29</td>
<td align="left">London</td>
<td align="left">hannah88@powers.com</td>
<td align="right">0</td>
<td align="left">('JL', 'AL')</td>
<td align="left"></td>
</tr>
<tr>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">Julia</td>
<td align="left">Taylor</td>
<td align="left">2015-07-31</td>
<td align="left">London</td>
<td align="left">hannah88@powers.com</td>
<td align="right">0</td>
<td align="left">('JL', 'AL')</td>
<td align="left">('TLR', '')</td>
</tr>
<tr>
<td align="right">2</td>
<td align="right">2</td>
<td align="left">Julia</td>
<td align="left">Taylor</td>
<td align="left">2016-01-27</td>
<td align="left">London</td>
<td align="left">hannah88@powers.com</td>
<td align="right">0</td>
<td align="left">('JL', 'AL')</td>
<td align="left">('TLR', '')</td>
</tr>
<tr>
<td align="right">3</td>
<td align="right">3</td>
<td align="left">Julia</td>
<td align="left">Taylor</td>
<td align="left">2015-10-29</td>
<td align="left"></td>
<td align="left">hannah88opowersc@m</td>
<td align="right">0</td>
<td align="left">('JL', 'AL')</td>
<td align="left">('TLR', '')</td>
</tr>
<tr>
<td align="right">4</td>
<td align="right">4</td>
<td align="left">oNah</td>
<td align="left">Watson</td>
<td align="left">2008-03-23</td>
<td align="left">Bolton</td>
<td align="left">matthew78@ballard-mcdonald.net</td>
<td align="right">1</td>
<td align="left">('AN', '')</td>
<td align="left">('ATSN', 'FTSN')</td>
</tr>
</tbody>
</table>
<p>Note: <a href="phonetic.html#soundex">Soundex</a> and <a href="phonetic.html#metaphone">Metaphone</a> are also supported in <a href="https://pypi.org/project/phonetics/">phoneitcs</a> </p>
<p>Now that the dmetaphone columns have been added, they can be used within comparisons. For example, using the <a href="../comparison_template_library.html#splink.comparison_template_library.NameComparisonBase">name_comparison</a> function from the <a href="customising_comparisons.html#name-comparisons">comparison template library</a>.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">splink.duckdb.duckdb_comparison_template_library</span> <span class="k">as</span> <span class="nn">ctl</span>

<span class="n">first_name_comparison</span> <span class="o">=</span> <span class="n">ctl</span><span class="o">.</span><span class="n">name_comparison</span><span class="p">(</span>
                            <span class="s2">&quot;first_name&quot;</span><span class="p">,</span>
                            <span class="n">phonetic_col_name</span> <span class="o">=</span> <span class="s2">&quot;first_name_dm&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_name_comparison</span><span class="o">.</span><span class="n">human_readable_description</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Comparison 'Exact match vs. Names with phonetic exact match vs. Names within jaro_winkler thresholds 0.95, 0.88 vs. anything else' of "first_name" and "first_name_dm".</p>
<p>Similarity is assessed using the following ComparisonLevels:</p>
<ul>
<li>'Null' with SQL rule: "first_name_l" IS NULL OR "first_name_r" IS NULL</li>
<li>'Exact match first_name' with SQL rule: "first_name_l" = "first_name_r"</li>
<li>'Exact match first_name_dm' with SQL rule: "first_name_dm_l" = "first_name_dm_r"</li>
<li>'Jaro_winkler_similarity &gt;= 0.95' with SQL rule: jaro_winkler_similarity("first_name_l", "first_name_r") &gt;= 0.95</li>
<li>'Jaro_winkler_similarity &gt;= 0.88' with SQL rule: jaro_winkler_similarity("first_name_l", "first_name_r") &gt;= 0.88</li>
<li>'All other comparisons' with SQL rule: ELSE</li>
</ul>
</blockquote>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="querying_splink_results.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Retrieving and querying Splink results" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Retrieving and querying Splink results
            </div>
          </div>
        </a>
      
      
        
        <a href="customising_comparisons.html" class="md-footer__link md-footer__link--next" aria-label="Next: Defining and customising comparisons" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Defining and customising comparisons
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.tabs.link", "content.tooltips", "header.autohide", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
    
  </body>
</html>